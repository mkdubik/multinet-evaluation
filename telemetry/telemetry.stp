global start
global dataset
global layers

function timestamp:long(ts) {
  return gettimeofday_ms() - ts
}

/* START OF LART INSTRUMENTATION */
probe process(@1).mark("lart_start")
{
  start = gettimeofday_ms();
  dataset = user_string($arg1);
  layers = $arg2
  printf("lart,%s_%d,", dataset, layers);
}

probe process(@1).mark("lart_ac_start")
{
  system(sprintf("cat /proc/%d/status > telemetry/lart_%s_%d.log", pid(), dataset, layers));
}

probe process(@1).mark("lart_end")
{
  printf("%d\n", timestamp(start));
}

/* START OF GLOUVAIN INSTRUMENTATION */
probe process(@1).mark("glouvain_start")
{
  start = gettimeofday_ms();
  dataset = user_string($arg1);
  layers = $arg2
  printf("glouvain,%s,%d,", dataset, layers);
}

probe process(@1).mark("glouvain_modularity")
{
  system(sprintf("cat /proc/%d/status > telemetry/glouvain_%s_%d.log", pid(), dataset, layers));
}

probe process(@1).mark("glouvain_end")
{
  printf("%d\n", timestamp(start));
}

/* START OF PMM INSTRUMENTATION */
probe process(@1).mark("pmm_start")
{
  start = gettimeofday_ms();
  dataset = user_string($arg1);
  layers = $arg2
  printf("pmm,%s,%d,", dataset, layers);
}

probe process(@1).mark("pmm_kmeans_start")
{
  system(sprintf("cat /proc/%d/status > telemetry/pmm_%s_%d.log", pid(), dataset, layers));
}

probe process(@1).mark("pmm_end")
{
  printf("%d\n", timestamp(start));
}
